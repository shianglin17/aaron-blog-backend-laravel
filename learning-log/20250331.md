# 2025-03-31 學習日誌

## Laravel 專案配置與服務提供者

### 1. 基礎配置更新 (config/app.php)
- 更新時區為 `Asia/Taipei`
- 設定預設語言為 `zh_TW`
- 配置 Faker 語言為 `zh_TW`
- 添加並組織所有必要的服務提供者
- 設定常用的 Facades 別名

### 2. 服務提供者設置
#### 2.1 AuthServiceProvider
- 位置：`app/Providers/AuthServiceProvider.php`
- 功能：處理認證和授權相關的服務
- 主要組件：
  - policies 陣列：定義模型與策略的對應關係
  - boot 方法：註冊認證/授權服務

#### 2.2 EventServiceProvider
- 位置：`app/Providers/EventServiceProvider.php`
- 功能：處理事件監聽器的註冊
- 主要組件：
  - listen 陣列：定義事件與監聽器的對應關係
  - shouldDiscoverEvents：控制事件自動發現功能

### 3. API 認證設置
- 安裝 Laravel Sanctum：`composer require laravel/sanctum`
- 發布 Sanctum 配置：`php artisan vendor:publish --provider="Laravel\Sanctum\SanctumServiceProvider"`
- 配置包含：
  - 遷移文件
  - 配置文件 (config/sanctum.php)

## 學習重點
1. **服務提供者的重要性**
   - 作為 Laravel 應用的核心引導機制
   - 負責註冊服務、綁定接口等
   - 提供應用程式的擴展點

2. **本地化配置**
   - 時區設定對於日期處理的重要性
   - 多語言支援的基礎設置
   - Faker 本地化對測試數據的影響

3. **API 認證最佳實踐**
   - Sanctum 作為輕量級 API 認證解決方案
   - 配置過程和注意事項
   - 安全性考慮

## 待優化項目
- [ ] 實現完整的認證邏輯
- [ ] 添加自定義的授權策略
- [ ] 設計更細緻的事件監聽系統
- [ ] 完善 API 認證的錯誤處理
- [ ] 添加請求限流策略

## 參考資源
- [Laravel 服務提供者文檔](https://laravel.com/docs/providers)
- [Laravel Sanctum 文檔](https://laravel.com/docs/sanctum)
- [Laravel 本地化文檔](https://laravel.com/docs/localization)

## 今日指令備忘
```bash
# 安裝 Sanctum
composer require laravel/sanctum

# 發布 Sanctum 配置
php artisan vendor:publish --provider="Laravel\Sanctum\SanctumServiceProvider"
```

## 注意事項
1. 確保服務提供者的順序正確
2. 在修改配置後需要清除配置快取
3. 注意 API 認證的安全性設置
4. 定期檢查並更新依賴包版本

# Laravel 日期處理最佳實踐

## 時間：2025-03-31 15:00

### 主題：Model 日期欄位處理

#### 問題描述
在使用 Laravel Resource 處理日期時遇到 "Call to a member function format() on string" 錯誤，這是因為日期欄位沒有被正確轉換為 Carbon 實例。

#### 解決方案
1. 使用 `$casts` 而不是 `$dates`
```php
protected $casts = [
    'published_at' => 'datetime',
    'created_at' => 'datetime',
    'updated_at' => 'datetime',
];
```

2. 在 Resource 中安全地處理日期
```php
'created_at' => $this->created_at?->format('Y-m-d H:i:s'),
```

#### 最佳實踐
1. 總是使用 `$casts` 來定義日期欄位，這是 Laravel 推薦的方式
2. 使用空值運算符 `?->` 來安全地處理可能為 null 的日期
3. 明確定義所有需要日期轉換的欄位，包括 `created_at` 和 `updated_at`

#### 相關文檔
- [Laravel 文檔 - Eloquent: Mutators & Casting](https://laravel.com/docs/10.x/eloquent-mutators)
- [Laravel 文檔 - Eloquent Resources](https://laravel.com/docs/10.x/eloquent-resources)

#### 注意事項
- `$dates` 屬性雖然仍然可用，但在新版本中推薦使用 `$casts`
- 使用 `$casts` 可以更靈活地定義轉換類型，不限於日期
- 在處理 API 響應時，確保日期格式統一很重要
